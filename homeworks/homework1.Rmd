---
title: "Homework 1"
author: "Ginevra Carbone"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(arm)
library(pandocfilters)
library(stats)
library(aer)
```

**TH-1:** Linear regression slides, slide 20: fit the same model with the function `bayesglm()` of the `arm` package and comment. Then, use an informative prior and comment the results.

```{r message=FALSE}

bayesglm(dist ~ speed, data=cars)
```

**BDA-1:** Ex 2.7 (p. 58) - Noninformative prior densities.

(a) For the binomial likelihood, $y ∼ Bin(n, θ)$, show that $p(θ) ∝ θ ^{−1} (1 − θ)^{−1}$ is the uniform prior distribution for the natural parameter of the exponential family.
(b) Show that if $y = 0$ or $n$, the resulting posterior distribution is improper.

```{r}

```

**BDA-2:** Ex 2.8 (p. 58) - Normal distribution with unknown mean.

A random sample of $n$ students is drawn from a large population, and their weights are measured. The average weight of the $n$ sampled students is $y = 150$ pounds. Assume the weights in the population are normally distributed with unknown mean $θ$ and known standard deviation 20 pounds. Suppose your prior distribution for $θ$ is normal with mean 180 and standard deviation 40.

(a) Give your posterior distribution for $θ$. (Your answer will be a function of $n$.)

Prior $\theta \sim \mathcal{N}(\theta_0, \sigma_0^2) = \mathcal{N}(180,40^2)$ gives $\pi(\theta) \propto exp\Big(-\frac{(\theta-180)^2}{2 \cdot 40^2}\Big)$.

Likelihood $y | \theta \sim \mathcal{N}(\theta, \sigma^2) = \mathcal{N}(\theta, 20^2)$ gives 

\begin{align}

p(y|\theta) 
  & = \Pi_{i=1}^n f_Y(y_i; \theta, 20^2) = \Pi_{i=1}^n \frac{1}{\sqrt{2 \pi 20^2}} exp\Big(-\frac{(y_i - \theta)^2}{2\cdot 20^2}\Big) \\
  & \propto exp \Big(\sum(y_i - \theta)^2 \Big)  \propto exp \Big( -2\theta \cdot 150 n + n \theta^2 \Big)
  
\end{align}

So we get the posterior 

$$
\pi(\theta | y) \propto p(y | \theta) \pi(\theta) \propto exp\Bigg(-\frac{(\theta-180)^2}{2\cdot 40^2}-2 \theta \cdot 150n+n \theta^2\Bigg)
$$

which, after proper calculations, becomes the following normal distribution

\begin{align}
\theta | y \sim
\mathcal{N}(\theta_0',\sigma_0')
&= \mathcal{N}
\Bigg( 
\frac{180 \cdot 20^2+150 \cdot n \cdot 20^2}{20^2 + n\cdot 40^2}, 
\frac{20^2 \cdot 40^2}{20^2+n40^2}
\Bigg)\\

&= \mathcal{N}\Bigg(\frac{72000+240000 n}{400+1600n}, \frac{640000}{400+1600n}\Bigg) 
\end{align}

(b) A new student is sampled at random from the same population and has a weight of $\tilde{y}$ pounds. Give a posterior predictive distribution for $\tilde{y}$. (Your answer will still be a function of $n$.)

The posterior predictive distribution on the observed data $y$ is

$$
p(\tilde{y} | y) = \int_{\Theta} p(\tilde{y} | \theta) \pi(\theta|y)d\theta 
$$

so in our case

$$
\tilde{y} | y
  \sim  \mathcal{N} (\tilde{y} | \theta_0',\sigma_0'+\sigma^2)
  = \mathcal{N}\Bigg(\frac{72000+240000 n}{400+1600n}, \frac{640000}{400+1600n}+400\Bigg)
$$

(c) For $n = 10$, give a 95% posterior interval for $θ$ and a 95% posterior predictive interval
for $ỹ$.

The posterior interval for $\theta$ is the interval whose extremes are the $\alpha/2=0.025$ and $1-\alpha/2=0.975$ quantiles of $\pi(\theta | y)$. The same holds for $y$ and the quantiles of $p(\tilde{y},y)$.

```{r}
theta_l = qnorm(.025, 150.731707317, sqrt(39.024390244))
theta_r = qnorm(.975, 150.731707317, sqrt(39.024390244))
cat("posterior interval for theta: [", theta_l, "," , theta_r, "]")

theta_l = qnorm(.025, 150.731707317, sqrt(439.024390244))
theta_r = qnorm(.975, 150.731707317, sqrt(439.024390244))
cat("posterior predictive interval for y_tilde: [", theta_l, "," , theta_r, "]")
```

(d) Do the same for n = 100.

```{r}
theta_l = qnorm(.025, 150.074812968, sqrt(3.990024938))
theta_r = qnorm(.975, 150.074812968, sqrt(3.990024938))
cat("posterior interval for theta: [", theta_l, "," , theta_r, "]")

theta_l = qnorm(.025, 150.074812968, sqrt(403.990024938))
theta_r = qnorm(.975, 150.074812968, sqrt(403.990024938))
cat("posterior predictive interval for y_tilde: [", theta_l, "," , theta_r, "]")

```

**LAB-1:** Repeat the lab session using the dataset ShipAccidents in the AER package.

```{r}

```

